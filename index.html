<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outfit Challenge - Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        :root { --bg-pink: #FFD1DC; --accent-purple: #5D2E46; --highlight-pink: #FF69B4; }
        body { background-color: var(--bg-pink); color: var(--accent-purple); font-family: 'Nunito', sans-serif; background-image: radial-gradient(var(--highlight-pink) 0.5px, transparent 0.5px); background-size: 20px 20px; }
        .title-text { font-weight: 900; text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.6); }
        #filter-panel { max-height: 0; overflow: hidden; transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        #filter-panel.open { max-height: 1500px; padding-bottom: 2rem; }
        .cloth-card { background: white; border: 3px solid var(--accent-purple); border-radius: 24px; box-shadow: 8px 8px 0px var(--accent-purple); opacity: 0; transform: translateY(30px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .cloth-card.show { opacity: 1; transform: translateY(0); }
        .btn-main { background: var(--accent-purple); box-shadow: 0px 6px 0px #3d1e2e; transition: all 0.2s; }
        .btn-main:active { transform: translateY(4px); box-shadow: 0px 2px 0px #3d1e2e; }
        .slider-disabled { opacity: 0.3; pointer-events: none; filter: grayscale(1); }
        .random-toggle-active { background: var(--highlight-pink) !important; color: white !important; border-color: transparent !important; }
        input[type="checkbox"], input[type="range"] { accent-color: var(--accent-purple); cursor: pointer; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4">

    <h1 class="title-text text-5xl md:text-6xl mb-10 uppercase italic text-center">Style Generator</h1>

    <div id="result-container" class="flex flex-wrap justify-center gap-8 mb-12 min-h-[350px] w-full max-w-7xl">
        <div class="flex items-center justify-center border-4 border-dashed border-white/50 rounded-[3rem] w-56 h-72 text-white font-black text-6xl">?</div>
    </div>

    <div class="w-full max-w-4xl flex flex-col items-center gap-6">
        <div class="flex gap-4">
            <button onclick="handleGenerate()" class="btn-main text-white px-12 py-5 rounded-full font-black text-2xl tracking-widest">START</button>
            <button onclick="toggleFilter()" class="bg-white/50 border-2 border-current px-8 py-5 rounded-full font-black text-lg hover:bg-white transition-all shadow-sm">细节筛选 ⚙️</button>
        </div>

        <div id="filter-panel" class="w-full mt-4 bg-white/70 backdrop-blur-md rounded-[3rem] border-2 border-white shadow-2xl">
            <div class="p-10">
                <div class="flex justify-center mb-10">
                    <button id="chaos-btn" onclick="toggleChaosMode()" class="border-4 border-purple-800 px-10 py-3 rounded-full font-black italic bg-white/50">✨ 开启全随机模式 (1-3件)</button>
                </div>

                <div id="sliders-container" class="grid grid-cols-1 md:grid-cols-2 gap-12 mb-10 pb-10 border-b-2 border-purple-200 text-center md:text-left">
                    <div>
                        <span class="font-black text-2xl italic">主要服饰: <span id="main-val" class="bg-[#5D2E46] text-white px-4 py-1 rounded-full text-lg ml-2">1</span></span>
                        <input type="range" id="main-limit" min="1" max="3" value="1" class="w-full mt-4" oninput="updateVal('main')">
                    </div>
                    <div>
                        <span class="font-black text-2xl italic">饰品数量: <span id="acc-val" class="bg-[#5D2E46] text-white px-4 py-1 rounded-full text-lg ml-2">0</span></span>
                        <input type="range" id="acc-limit" min="0" max="3" value="0" class="w-full mt-4" oninput="updateVal('acc')">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-16">
                    <div>
                        <div class="flex items-center gap-3 mb-6 font-black text-2xl italic"><input type="checkbox" id="all-main" checked onchange="toggleGroup('main', this.checked)"> 主要服饰</div>
                        <div id="main-list" class="flex flex-wrap gap-4 font-bold"></div>
                    </div>
                    <div>
                        <div class="flex items-center gap-3 mb-6 font-black text-2xl italic"><input type="checkbox" id="all-acc" onchange="toggleGroup('acc', this.checked)"> 额外饰品</div>
                        <div id="acc-list" class="flex flex-wrap gap-4 font-bold"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>

    <script>
        const CATEGORY_MAP = {
            main: [{id:'hair',n:'发型'},{id:'dress',n:'连衣裙'},{id:'top',n:'上衣'},{id:'bottom',n:'下装'},{id:'socks',n:'袜子'},{id:'shoes',n:'鞋子'}],
            acc: [
                {id:'acc_hair',n:'发饰'},{id:'acc_hat',n:'帽子'},{id:'acc_ear',n:'耳饰'},{id:'acc_neck',n:'颈饰'},
                {id:'acc_wrist',n:'腕饰'},{id:'acc_choker',n:'项圈'},{id:'acc_glove',n:'手套'},{id:'acc_face',n:'面饰'},
                {id:'acc_chest',n:'胸饰'},{id:'acc_pendant',n:'挂饰'},{id:'acc_back',n:'背饰'},{id:'acc_ring',n:'戒指'},
                {id:'acc_arm',n:'臂饰'},{id:'acc_handheld',n:'手持物'},{id:'acc_paint',n:'绘肤'}
            ]
        };

        let isChaosMode = false;

        function init() {
            const render = (gid, data, isDef) => {
                document.getElementById(`${gid}-list`).innerHTML = data.map(c => `
                    <label class="flex items-center gap-2 bg-white px-4 py-1.5 rounded-full border border-purple-100 hover:border-pink-400 cursor-pointer shadow-sm">
                        <input type="checkbox" class="${gid}-item" data-id="${c.id}" ${isDef ? 'checked' : ''} onchange="updateParent('${gid}')"> ${c.n}
                    </label>`).join('');
            };
            render('main', CATEGORY_MAP.main, true);
            render('acc', CATEGORY_MAP.acc, false);
        }

        function handleGenerate() {
            if (typeof CLOTH_DATABASE === 'undefined') return alert("未找到 data.js 文件！");
            let pMain = [...document.querySelectorAll('.main-item:checked')].map(e => e.dataset.id);
            let pAcc = [...document.querySelectorAll('.acc-item:checked')].map(e => e.dataset.id);
            if (!pMain.length && !pAcc.length) return alert("请勾选分类！");

            if (pMain.includes('dress') && (pMain.includes('top') || pMain.includes('bottom'))) {
                Math.random() > 0.5 ? pMain = pMain.filter(c => c !== 'top' && c !== 'bottom') : pMain = pMain.filter(c => c !== 'dress');
            }

            let nMain, nAcc;
            if (isChaosMode) {
                const target = Math.min(Math.floor(Math.random() * 3) + 1, pMain.length + pAcc.length);
                nMain = Math.min(target, pMain.length);
                nAcc = Math.min(target - nMain, pAcc.length);
            } else {
                nMain = Math.min(parseInt(document.getElementById('main-limit').value), pMain.length);
                nAcc = Math.min(parseInt(document.getElementById('acc-limit').value), pAcc.length);
            }

            const pick = (arr, n) => arr.sort(() => 0.5 - Math.random()).slice(0, n);
            renderResult([...pick(pMain, nMain), ...pick(pAcc, nAcc)]);
        }

        function renderResult(selection) {
            const container = document.getElementById('result-container');
            container.innerHTML = '';
            selection.forEach((cat, i) => {
                const pool = CLOTH_DATABASE.filter(d => d.cat === cat);
                if (!pool.length) return;
                const item = pool[Math.floor(Math.random() * pool.length)];

                const card = document.createElement('div');
                card.className = 'cloth-card w-56 h-72 p-3 group relative';
                card.innerHTML = `
                    <div class="w-full h-full rounded-[20px] bg-gray-50 overflow-hidden border-2 border-purple-50">
                        <img src="images/${item.img}" class="w-full h-full object-cover group-hover:scale-110 transition-all duration-700">
                    </div>
                    <div class="absolute inset-3 bg-[#5D2E46ee] opacity-0 group-hover:opacity-100 transition-all duration-300 flex flex-col items-center justify-center p-4 rounded-[20px]">
                        <img src="ui/star${item.star}.png" class="w-24 mb-2">
                        <h3 class="text-white font-black text-lg mb-3">${item.name}</h3>
                        <div class="flex flex-wrap justify-center gap-1">${item.tags.map(t => `<img src="ui/tag_${t}.png" class="h-6">`).join('')}</div>
                    </div>
                    <div class="absolute bottom-5 left-5 right-5 text-center group-hover:opacity-0 transition-opacity">
                        <span class="bg-white/95 text-[#5D2E46] text-xs px-3 py-1 rounded-full font-black shadow-sm">${item.name}</span>
                    </div>`;
                container.appendChild(card);
                setTimeout(() => card.classList.add('show'), i * 150);
            });
        }

        function toggleChaosMode() { isChaosMode = !isChaosMode; document.getElementById('chaos-btn').classList.toggle('random-toggle-active'); document.getElementById('sliders-container').classList.toggle('slider-disabled'); }
        function updateVal(t) { document.getElementById(`${t}-val`).innerText = document.getElementById(`${t}-limit`).value; }
        function toggleFilter() { document.getElementById('filter-panel').classList.toggle('open'); }
        function toggleGroup(g, c) { document.querySelectorAll(`.${g}-item`).forEach(i => i.checked = c); updateParent(g); }
        function updateParent(g) { const items = document.querySelectorAll(`.${g}-item`); document.getElementById(`all-${g}`).checked = [...items].length > 0 && [...items].every(i => i.checked); }

        init();
    </script>
</body>
</html>
